---
import ThemeToggle from "./ThemeToggle.astro";
import { mods } from "../data/mods";

const navItems = [
  { name: "Home", href: `${import.meta.env.BASE_URL}` },
  { name: "Mods", href: `${import.meta.env.BASE_URL}mods/` },
  { name: "Features", href: `${import.meta.env.BASE_URL}features/` },
  { name: "Docs", href: `${import.meta.env.BASE_URL}docs/` },
  { name: "FAQ", href: `${import.meta.env.BASE_URL}faq/` },
  { name: "Support", href: `${import.meta.env.BASE_URL}support/` },
];

// Get mods for the screenshots dropdown (exclude the main "Taj's Mod" bundle)
const screenshotMods = mods.filter((mod) => mod.slug !== "tajs-mod");

const currentPath = Astro.url.pathname;
---

<!-- Floating Glassmorphic Navigation -->
<nav
  class="fixed top-4 left-1/2 -translate-x-1/2 w-11/12 max-w-7xl z-50 glass-panel rounded-2xl px-6 py-4"
>
  <div class="flex items-center justify-between">
    <!-- Logo -->
    <a
      href={`${import.meta.env.BASE_URL}`}
      class="flex items-center gap-3 group"
    >
      <div
        class="w-8 h-8 rounded bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center font-bold text-white shadow-lg transition-transform group-hover:scale-105"
      >
        T
      </div>
      <span class="font-bold text-lg tracking-wide text-white hidden sm:block"
        >Taj's Mods</span
      >
    </a>

    <!-- Desktop Navigation -->
    <div class="hidden lg:flex items-center gap-8 text-sm font-medium">
      {
        navItems.map((item) => {
          const isActive =
            currentPath === item.href ||
            (item.href !== `${import.meta.env.BASE_URL}` &&
              currentPath.startsWith(item.href));
          return (
            <a
              href={item.href}
              class:list={[
                "transition-colors hover:text-white",
                isActive ? "text-white" : "text-gray-400",
              ]}
            >
              {item.name}
            </a>
          );
        })
      }

      <!-- Screenshots Dropdown -->
      <div class="relative group">
        <button
          class="text-gray-400 hover:text-white flex items-center gap-1 transition-colors"
        >
          Screenshots
          <svg
            class="w-4 h-4 transition-transform group-hover:rotate-180"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>

        <!-- Dropdown Menu -->
        <div
          class="absolute top-full left-1/2 -translate-x-1/2 pt-2 w-64 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform z-50"
        >
          <div class="glass-panel rounded-xl overflow-hidden p-2">
            {
              screenshotMods.map((mod) => (
                <a
                  href={`${import.meta.env.BASE_URL}screenshots/${mod.name}/`}
                  class="flex items-center gap-3 px-4 py-3 text-sm text-gray-300 hover:bg-white/10 hover:text-primary rounded-lg transition-colors"
                >
                  {mod.logo && (
                    <img
                      src={`${import.meta.env.BASE_URL}${mod.logo}`}
                      alt=""
                      class="w-6 h-6 rounded"
                    />
                  )}
                  <span class="font-medium">{mod.name}</span>
                </a>
              ))
            }
            <div class="h-px bg-white/10 my-1"></div>
            <a
              href={`${import.meta.env.BASE_URL}mods/`}
              class="flex items-center gap-3 px-4 py-3 text-xs text-gray-400 hover:bg-white/10 rounded-lg transition-colors justify-center font-medium"
            >
              View all mods
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Side Actions -->
    <div class="flex items-center gap-4">
      <ThemeToggle />

      <a
        href="https://steamcommunity.com/sharedfiles/filedetails/?id=3628222709"
        target="_blank"
        rel="noopener noreferrer"
        class="bg-primary hover:bg-primary-hover text-white px-5 py-2 rounded-lg text-sm font-semibold shadow-lg shadow-orange-500/20 transition-all transform hover:scale-105 hidden sm:inline-flex"
      >
        Subscribe
      </a>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        class="lg:hidden p-2 rounded-lg hover:bg-white/10 transition-colors text-white"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Navigation -->
  <div id="mobile-menu" class="hidden lg:hidden pt-4">
    <div class="flex flex-col gap-1 pt-4 border-t border-white/10">
      {
        navItems.map((item) => {
          const isActive =
            currentPath === item.href ||
            (item.href !== `${import.meta.env.BASE_URL}` &&
              currentPath.startsWith(item.href));
          return (
            <a
              href={item.href}
              class:list={[
                "px-4 py-3 rounded-lg font-medium transition-colors",
                isActive
                  ? "bg-white/10 text-white"
                  : "text-gray-300 hover:bg-white/5",
              ]}
            >
              {item.name}
            </a>
          );
        })
      }

      <!-- Screenshots links in mobile -->
      <div class="border-t border-white/10 mt-2 pt-2">
        <p class="px-4 py-2 text-xs text-gray-500 uppercase tracking-wider">
          Screenshots
        </p>
        {
          screenshotMods.slice(0, 4).map((mod) => (
            <a
              href={`${import.meta.env.BASE_URL}screenshots/${mod.name}/`}
              class="px-4 py-2 rounded-lg text-gray-300 hover:bg-white/5 transition-colors flex items-center gap-2"
            >
              {mod.logo && (
                <img
                  src={`${import.meta.env.BASE_URL}${mod.logo}`}
                  alt=""
                  class="w-5 h-5 rounded"
                />
              )}
              {mod.name}
            </a>
          ))
        }
      </div>

      <a
        href="https://steamcommunity.com/sharedfiles/filedetails/?id=3628222709"
        target="_blank"
        rel="noopener noreferrer"
        class="btn-primary mt-4 justify-center"
      >
        Subscribe on Steam
      </a>
    </div>
  </div>
</nav>

<!-- Spacer for floating header -->
<div class="h-24"></div>

<script>
  function initMobileMenu() {
    const btn = document.getElementById("mobile-menu-btn");
    const menu = document.getElementById("mobile-menu");

    btn?.addEventListener("click", () => {
      const isOpen = menu?.classList.contains("hidden");
      menu?.classList.toggle("hidden", !isOpen);
      btn?.setAttribute("aria-expanded", isOpen ? "true" : "false");
    });
  }

  document.addEventListener("astro:page-load", initMobileMenu);
  initMobileMenu();
</script>
